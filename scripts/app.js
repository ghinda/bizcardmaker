!function(){"use strict";function o(e,t){return!!e.className&&-1!==(" "+e.className+" ").indexOf(t=" "+t+" ")}window.util={closest:function(e,t){for(var o;e&&e!==document;){if(!e.parentNode)return null;if(o=e.parentNode.querySelectorAll(t),-1!==[].indexOf.call(o,e))return e;e=e.parentNode}return null},hash:function(e){var t=window.location.hash.substr(1);return(t=t.substr(t.indexOf(e+"=")).split("&")[0].split("=")[1])||null},hasClass:o,addClass:function(e,t){return o(e,t)||(e.className&&(t=" "+t),e.className+=t),e.className},removeClass:function(e,t){var o=" "+t,r=t+" ";return-1!==e.className.indexOf(o)?e.className=e.className.replace(o,""):-1!==e.className.indexOf(r)?e.className=e.className.replace(r,""):e.className=e.className.replace(t,""),e.className}}}(),function(){"use strict";if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(e){window.Storage.prototype._setItem=window.Storage.prototype.setItem,window.Storage.prototype.setItem=function(){}}var e=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome"),t=document.querySelector(".warning-safari");e&&(t.className+="warning-safari-show")}(),function(){"use strict";var e=[{selector:".js-track-order",arguments:["Orders","Clicked Print Order button"]},{selector:".js-track-pdf",arguments:["Download","Download PDF"]},{selector:".js-track-picture",arguments:["Download","Download picture"]}];document.body.addEventListener("click",function(t){e.some(function(e){if(window.util.closest(t.target,e.selector))return ga.apply(null,["send","event"].concat(e.arguments)),!0})})}(),function(){"use strict";var t,o,r,n,a=document.querySelector(".js-gtemplates-popup");function e(){var e;r=window.localStorage.getItem(o),(!(e=r)||(e=Date.now()-parseInt(e,10),n<e))&&a.classList.remove(t)}a&&(t="gtemplates-popup-hide",o="gtemplates-popup",r=null,n=864e5,a.querySelector(".js-gtemplates-close").addEventListener("click",function(){a.classList.add(t),window.localStorage.setItem(o,String(Date.now()))}),setTimeout(function(){e()},2e3))}(),function(){"use strict";var e,t,o=document.querySelector(".themes-box");function r(){(e=window.util.hash("theme"))?((t=o.querySelector(".active"))&&window.util.removeClass(t,"active"),(t=o.querySelector(".js-"+e))&&window.util.addClass(t,"active")):o.querySelector(".theme-item").click()}o&&(r(),window.addEventListener("hashchange",r,!1))}(),window.GeneratePdf=function(){"use strict";var e=[3.75,2.25],r=.35,t=.125,n=e[0],a=e[1],e=t+r,t=r-t,o=.06,i=[{x:e,y:o,x1:e,y1:e-o},{x:o,y:e,x1:e-o,y1:e},{x:n+t,y:o,x1:n+t,y1:e-o},{x:n+t+o,y:e,x1:n+2*r-o,y1:e},{x:e,y:a+t+o,x1:e,y1:a+2*r-o},{x:o,y:a+t,x1:e-o,y1:a+t},{x:n+t,y:a+t+o,x1:n+t,y1:a+2*r-o},{x:n+t+o,y:a+t,x1:n+2*r-o,y1:a+t}];return function(e,t){var o=new jsPDF("landscape","in",[n+2*r,a+2*r]);o.addImage(t,"JPEG",r,r,n,a),i.forEach(function(e){o.setLineWidth(.01),o.line(e.x,e.y,e.x1,e.y1)}),o.save(e)}}();var app=angular.module("businessCardMaker",["ngRoute","angular-meditor"]);app.run(["$rootScope",function(e){"use strict";e.root={}}]),app.directive("fileread",[function(){"use strict";return{scope:{fileread:"="},link:function(t,e){e.bind("change",function(e){t.$apply(function(){t.fileread=e.target.files[0]})})}}}]),app.directive("drModel",["$document","$timeout",function(e,t){"use strict";return{template:'<div class="dr-container"><div class="drag-handle"></div><div class="resize-handle"></div><div ng-transclude></div></div>',scope:{drModel:"=",drContainer:"@",drGrid:"@"},replace:!0,transclude:!0,link:function(r,i){function o(e){return e%M==0?e:e-e%M}function t(e){var t;(E||b)&&(e.preventDefault(),v=o(e.touches[0].pageX-h),y=o(e.touches[0].pageY-w),x<v&&(v=x),C<y&&(y=C),E&&(t="translate3d("+(v=v<S?S:v)+"px ,"+(y=y<L?L:y)+"px, 0)",angular.forEach(g,function(e){i.css(e,t)})),b&&(e=i._startHeight+y,i.css("height",e),e=i._startWidth+v,i.css("width",e)))}function e(e){var t,o;(E||b)&&(E&&(E=!1,angular.forEach(g,function(e){i.css(e,"")}),t=v,o=y,"absolute"===i.css("position")?(t+=i[0].offsetLeft,o+=i[0].offsetTop):(i.css("left")&&"auto"!==i.css("left")&&(t=parseInt(i.css("left"),10)+v),i.css("top")&&"auto"!==i.css("top")&&(o=parseInt(i.css("top"),10)+y)),i.css({top:o,left:t,bottom:"auto",right:"auto"}),r.drModel&&(r.drModel.x=t,r.drModel.y=o)),b&&(b=!1,r.drModel&&(r.drModel.width=parseInt(i.css("width")),r.drModel.height=parseInt(i.css("height")))),u.classList.remove(l),i[0].classList.remove(d))}function n(e){var t,o,r,n,a=e.target;t=m.getBoundingClientRect(),o=f.getBoundingClientRect(),r=t.top,n=t.left,L=r-o.top,L=0-D(L),C=o.top+o.height-r-t.height,C=D(C),S=n-o.left,S=0-D(S),x=o.left+o.width-n-t.width,x=D(x),v=y=0,h=e.touches[0].pageX-v,w=e.touches[0].pageY-y,a===p?(b=!0,i._startHeight=parseInt(i.css("height")),i._startWidth=parseInt(i.css("width"))):E=!0,u.classList.add(l),i[0].classList.add(d)}function a(e){return e.touches=[{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}],e}var s,c,l="dr-active",d="dr-handle-show",u=document.getElementsByTagName("body")[0],f=u,m=(r.drContainer&&(f=document.querySelector(r.drContainer)),i[0].querySelector(".drag-handle")),p=i[0].querySelector(".resize-handle"),g=["webkitTransform","msTransform","transform"],h=0,w=0,v=0,y=0,S=0,x=0,L=0,C=0,E=!1,b=!1,M=r.drGrid,D=function(e){return Math.floor(e/M)*M};r.$watch("drModel",function(){r.drModel.x=r.drModel.x||"",i.css({left:r.drModel.x}),r.drModel.y=r.drModel.y||"",i.css({top:r.drModel.y}),r.drModel.width=r.drModel.width||"",i.css({width:r.drModel.width}),r.drModel.height=r.drModel.height||"",i.css({height:r.drModel.height})},!0),p.addEventListener("mousedown",function(e){n(a(e))}),p.addEventListener("touchstart",n),m.addEventListener("mousedown",function(e){n(a(e))}),m.addEventListener("touchstart",n),document.addEventListener("mousemove",function(e){t(a(e))}),document.addEventListener("touchmove",t),document.addEventListener("mouseup",e),document.addEventListener("touchend",e),window.addEventListener("scroll",function(e){E?(u.scrollTop=s,u.scrollLeft=c):(s=u.scrollTop,c=u.scrollLeft)})}}}]),app.controller("MainCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","$q",function(e,t,o,r,n,i){"use strict";function s(o){var e=window.getComputedStyle(o.parentNode,null),r=window.getComputedStyle(o,null),n=parseFloat(r.fontSize),a=parseFloat(e.fontSize),i="",s={};["left","top","width","height"].forEach(function(e){var t;(i=o.style[e])&&-1===i.indexOf("em")&&(t=parseFloat(r[e])/a,s[e]=(t+=(t-t*(e=n/a))/e)+"em")}),Object.keys(s).forEach(function(e){o.style[e]=s[e]}),"font"===o.tagName.toLowerCase()&&-1===r.fontSize.indexOf("em")&&(o.style.fontSize=n/a+"em")}var a,c,l,d=t.model={cardPictureFile:"",cardPicture:"",imageData:"",imageFilename:"bizcardmaker-com",imageExt:".jpg",pdfData:"",pdfFilename:"bizcardmaker-com.pdf",loadingCard:!1},u=new Date,u=(u.setDate(u.getDate()+23),d.promoExpire=u,d.storeDefaults={card:{name:"John Doe",position:"Position",organization:"Organization",location:"City, State",phone:"(123) 555-1234",email:"john.doe@cmail.com",url:"www.john-doe.com"},position:{picture:{},person:{},details:{},email:{},url:{}}},d.store={card:{},position:{}},angular.copy(d.storeDefaults,d.store),window.localStorage.getItem("bizcardmaker-store")),f=(u&&angular.extend(d.store,angular.fromJson(u)),t.$watch("model.store",(a=function(e){window.localStorage.setItem("bizcardmaker-store",angular.toJson(e))},c=500,function(){var e=this,t=arguments;clearTimeout(l),l=setTimeout(function(){a.apply(e,t)},c)}),!(l=null)),t.ResetCard=function(e){var t;document.querySelector(".card-preview")&&(t=document.querySelector(".card-preview").querySelectorAll("*"),angular.forEach(t,function(e){e.removeAttribute("style")})),e?angular.copy(d.storeDefaults.position,d.store.position):(t=d.store.theme,angular.copy(d.storeDefaults,d.store),d.store.theme=t),window.localStorage.removeItem("bizcardmaker-store")},d.store.theme&&r.search("theme",d.store.theme),t.$on("$locationChangeStart",function(){var e=r.search().theme;e!==d.store.theme&&t.ResetCard(!0),d.store.theme=e}),t.$watch("model.cardPictureFile",function(){var e;d.cardPictureFile&&(d.cardPictureFile.type.match(/image.*/)?((e=new FileReader).onload=function(){n(function(){d.cardPicture=e.result})},e.readAsDataURL(d.cardPictureFile)):window.alert("File not supported!"))}),{1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"}),m=(t.generatePicture=function(t){t=t||function(){};var e,o,r,n=i.defer(),a=(window.getSelection().removeAllRanges(),document.querySelector(".js-card-container").cloneNode(!0));return a.classList.add("card-invisible"),document.body.appendChild(a),r=(e=a).querySelectorAll("[contenteditable]"),angular.forEach(r,function(e){o=e.querySelectorAll("*"),angular.forEach(o,function(e){"font"===e.tagName.toLowerCase()&&(e.style.fontSize=f[e.size]+"px"),s(e)})}),r=e.querySelectorAll(".card-item[style]"),e=e.querySelector(".card-picture[style]"),angular.forEach(r,function(e){s(e)}),e&&s(e),a.classList.add("card-big"),d.loadingCard=!0,html2canvas(a,{letterRendering:!0}).then(function(e){document.body.removeChild(a),d.loadingCard=!1,n.resolve(e),t(e)}),n.promise},t.DownloadPdf=function(){t.generatePicture().then(function(e){e=e.toDataURL("image/jpeg",1);window.GeneratePdf(d.pdfFilename,e)})},t.DownloadPicture=function(){t.generatePicture().then(function(e){e.toBlob(function(e){var t=d.imageFilename+"-"+d.store.theme+d.imageExt;saveAs(e,t),$(".card-container")[0].scrollIntoView(!0)},"image/jpeg")})},0);t.$on("$includeContentLoaded",function(){if(1==++m){$(document.querySelector(".card-editor")).foundation();var t=document.querySelector(".card-content");if(t){var e=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){e=!0}}))}catch(e){}t.addEventListener("scroll",function(e){t.scrollTop=0,t.scrollLeft=0},!e||{passive:!0})}}})}]);
//# sourceMappingURL=app.js.map